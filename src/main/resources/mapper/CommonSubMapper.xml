<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.wimir.bae.domain.common.sub.mapper.CommonSubMapper">

    <!-- 하위 공통 코드 중복 검사 (대소문자 구분 없이) -->
    <select id="isUpperLowerCaseDuplicate" resultType="boolean">
        SELECT IF(COUNT(*) > 0, 1, 0)
        FROM tbl_common_code_sub
        WHERE is_deleted = 0
          AND UPPER(sub_common_name) = UPPER(#{subCommonName})
          AND main_common_key = #{mainCommonKey}
    </select>

    <!-- 하위 공통 코드 등록 -->
    <insert id="createCommonSub">
        INSERT INTO tbl_common_code_sub(
                main_common_key, sub_common_name, note
        )
        VALUES (
                #{mainCommonKey}, #{subCommonName}, #{note}
        )
    </insert>

    <!-- 하위 공통 코드 목록 조회 -->
    <select id="getCommonSubList" resultType="com.wimir.bae.domain.common.sub.dto.CommonSubInfoDTO">
        SELECT sub_common_key, sub_common_name, note, is_immutable
        FROM tbl_common_code_sub
        WHERE is_deleted = 0
    </select>

</mapper>